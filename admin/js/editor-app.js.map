{"version":3,"file":"editor-app.js","mappings":"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","sources":["webpack://block-factory-blocks/./src/editor-app.js"],"sourcesContent":["/**\r\n * Editor Application for defining block components.\r\n */\r\nconst { useState, useEffect, createElement } = wp.element;\r\nconst { Button, TextControl, Panel, PanelBody, SelectControl } = wp.components;\r\n\r\n// Define the available field types (your component palette)\r\nconst FIELD_TYPES = [\r\n    { label: 'Text Input', value: 'text' },\r\n    { label: 'Number Input', value: 'number' },\r\n    { label: 'Range Slider', value: 'range' }, // New\r\n    // { label: 'Email Address', value: 'email' }, // New (uses TextControl)\r\n    { label: 'URL Link', value: 'url' },       // New (uses URLInput or TextControl)\r\n    \r\n    { label: 'Text Area', value: 'textarea' },\r\n    { label: 'Rich Text Content', value: 'contentEditor' }, // Existing/Renamed (WYSIWYG)\r\n    \r\n    { label: 'Image/Media', value: 'image' },\r\n    { label: 'File Upload', value: 'file' }, // New (uses MediaUpload)\r\n    { label: 'Gallery', value: 'gallery' }, // New (complex, placeholder added)\r\n    \r\n    { label: 'Date Picker', value: 'date' },\r\n    { label: 'Date Time Picker', value: 'datetime' }, // New\r\n    { label: 'Time Picker', value: 'time' },         // New\r\n    \r\n    { label: 'Color Picker', value: 'color' },\r\n    { label: 'Icon Picker', value: 'icon' }, // New (Placeholder)\r\n    \r\n    { label: 'Repeater/Group', value: 'repeater' }, // Complex, requires nested fields\r\n    { label: 'Relational (Post Select)', value: 'relational' }, // Complex, placeholder added\r\n];\r\n\r\n// --- 1. The Main Application Component ---\r\nconst ComponentEditorApp = ({ initialConfig, blockSlug }) => {\r\n    // State to hold the array of fields (the component structure)\r\n    const [fields, setFields] = useState(initialConfig.fields || []);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [selectedField, setSelectedField] = useState(null); // Field being edited\r\n    const [message, setMessage] = useState('');\r\n\r\n    // --- Helper function to add a new field ---\r\n    const addField = (type) => {\r\n        const newField = {\r\n            type: type,\r\n            key: `new_field_${fields.length}`,\r\n            label: `New ${type} Field`,\r\n            default: '',\r\n        };\r\n        setFields([...fields, newField]);\r\n        setSelectedField(newField); // Automatically select the new field for editing\r\n    };\r\n\r\n    // --- Helper function to update a field's properties ---\r\n    const updateField = (index, property, value) => {\r\n        const newFields = fields.map((field, i) => {\r\n            if (i === index) {\r\n                // Ensure key is slugified\r\n                if (property === 'key') {\r\n                    value = value.toLowerCase().replace(/[^a-z0-9_]/g, '');\r\n                }\r\n                return { ...field, [property]: value };\r\n            }\r\n            return field;\r\n        });\r\n        setFields(newFields);\r\n        // Also update the selected field reference if it's the one being edited\r\n        setSelectedField(newFields[index]); \r\n    };\r\n\r\n    // --- Helper function to remove a field ---\r\n    const removeField = (index) => {\r\n        setFields(fields.filter((_, i) => i !== index));\r\n        setSelectedField(null);\r\n    };\r\n\r\n    // --- AJAX Save Handler ---\r\n    const handleSave = () => {\r\n        setIsSaving(true);\r\n        setMessage('');\r\n\r\n        const data = {\r\n            action: 'block_factory_save_structure',\r\n            nonce: blockFactoryEditorData.nonce, // Retrieve nonce from PHP\r\n            block_slug: blockSlug,\r\n            config_data: JSON.stringify({ fields }),\r\n        };\r\n\r\n        // Use standard jQuery/fetch for AJAX submission\r\n        jQuery.post(ajaxurl, data)\r\n            .done(response => {\r\n                if (response.success) {\r\n                    setMessage(`✅ Success! ${response.data.message} ${response.data.next_step}`);\r\n                } else {\r\n                    setMessage(`❌ Error: ${response.data.message}`);\r\n                }\r\n            })\r\n            .fail(() => {\r\n                setMessage('❌ Critical Error: Could not reach the server.');\r\n            })\r\n            .always(() => {\r\n                setIsSaving(false);\r\n            });\r\n    };\r\n\r\n    // --- Render the Field Settings Panel ---\r\n    const renderSettings = () => {\r\n        if (!selectedField) return <p>Select a field on the left to edit its properties.</p>;\r\n        \r\n        const index = fields.indexOf(selectedField);\r\n\r\n        return (\r\n            <Panel header=\"Field Settings\">\r\n                <PanelBody title={`Editing: ${selectedField.label} (${selectedField.type})`} initialOpen={true}>\r\n                    <TextControl\r\n                        label=\"Field Label\"\r\n                        value={selectedField.label}\r\n                        onChange={val => updateField(index, 'label', val)}\r\n                    />\r\n                    <TextControl\r\n                        label=\"Attribute Key (Variable Name)\"\r\n                        value={selectedField.key}\r\n                        help=\"Must be unique, lowercase, and contain only letters, numbers, and underscores.\"\r\n                        onChange={val => updateField(index, 'key', val)}\r\n                    />\r\n                    <TextControl\r\n                        label=\"Default Value (Optional)\"\r\n                        value={selectedField.default}\r\n                        onChange={val => updateField(index, 'default', val)}\r\n                    />\r\n                    <Button \r\n                        isDestructive \r\n                        onClick={() => removeField(index)} \r\n                        style={{marginTop: '10px'}}\r\n                    >\r\n                        Delete Field\r\n                    </Button>\r\n                </PanelBody>\r\n            </Panel>\r\n        );\r\n    };\r\n\r\n\r\n    return createElement(\r\n        'div',\r\n        { style: { display: 'flex', gap: '20px', marginTop: '20px' } },\r\n        \r\n        // --- Left Column: Component Palette ---\r\n        createElement(\r\n            'div',\r\n            { style: { width: '20%', borderRight: '1px solid #ccc', paddingRight: '20px' } },\r\n            createElement('h3', null, 'Component Palette'),\r\n            FIELD_TYPES.map(type => \r\n                createElement(Button, { \r\n                    isSecondary: true, \r\n                    style: { display: 'block', width: '100%', marginBottom: '10px' },\r\n                    onClick: () => addField(type.value)\r\n                }, type.label)\r\n            )\r\n        ),\r\n        \r\n        // --- Middle Column: Component Structure (The Fields List) ---\r\n        createElement(\r\n            'div',\r\n            { style: { width: '40%' } },\r\n            createElement('h3', null, 'Block Structure'),\r\n            \r\n            // Render the list of fields\r\n            fields.map((field, index) => \r\n                createElement('div', { \r\n                    key: index, \r\n                    style: { \r\n                        padding: '10px', \r\n                        marginBottom: '8px', \r\n                        border: '1px solid #ddd',\r\n                        backgroundColor: selectedField === field ? '#eaf4ff' : '#fff',\r\n                        cursor: 'pointer'\r\n                    },\r\n                    onClick: () => setSelectedField(field)\r\n                }, \r\n                    `${field.label} (${field.type})`\r\n                )\r\n            ),\r\n            \r\n            createElement('hr', null),\r\n            \r\n            // Save Button and Messages\r\n            createElement(Button, { \r\n                isPrimary: true,\r\n                isBusy: isSaving,\r\n                onClick: handleSave,\r\n                disabled: isSaving\r\n            }, isSaving ? 'Saving...' : 'Save Structure & Regenerate Code'),\r\n\r\n            message && createElement('p', { style: { marginTop: '15px', fontWeight: 'bold' } }, message)\r\n        ),\r\n\r\n        // --- Right Column: Settings Panel ---\r\n        createElement(\r\n            'div',\r\n            { style: { width: '40%' } },\r\n            renderSettings()\r\n        )\r\n    );\r\n};\r\n\r\n \r\n// --- Render the application once the DOM is ready ---\r\njQuery(document).ready(function() {\r\n    const rootElement = document.getElementById('component-editor-root');\r\n    \r\n    // Check if the localized data object exists (blockFactoryEditorData)\r\n    if (rootElement && typeof blockFactoryEditorData !== 'undefined') { \r\n        wp.element.render(\r\n            createElement(ComponentEditorApp, { \r\n                // CRITICAL: Access the nested properties\r\n                initialConfig: blockFactoryEditorData.config, \r\n                blockSlug: blockFactoryEditorData.blockSlug \r\n            }),\r\n            rootElement\r\n        );\r\n    }\r\n});\r\n\r\n"],"names":["useState","useEffect","createElement","wp","element","Button","TextControl","Panel","PanelBody","SelectControl","components","FIELD_TYPES","label","value","ComponentEditorApp","initialConfig","blockSlug","fields","setFields","isSaving","setIsSaving","selectedField","setSelectedField","message","setMessage","addField","type","newField","key","length","default","updateField","index","property","newFields","map","field","i","toLowerCase","replace","removeField","filter","_","handleSave","data","action","nonce","blockFactoryEditorData","block_slug","config_data","JSON","stringify","jQuery","post","ajaxurl","done","response","success","next_step","fail","always","renderSettings","indexOf","header","title","initialOpen","onChange","val","help","isDestructive","onClick","style","marginTop","display","gap","width","borderRight","paddingRight","isSecondary","marginBottom","padding","border","backgroundColor","cursor","isPrimary","isBusy","disabled","fontWeight","document","ready","rootElement","getElementById","render","config"],"ignoreList":[],"sourceRoot":""}