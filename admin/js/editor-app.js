(()=>{"use strict";const e=window.ReactJSXRuntime,{useState:l,useEffect:t,createElement:a}=wp.element,{Button:i,TextControl:n,Panel:o,PanelBody:r,SelectControl:s}=wp.components,d=[{label:"Text Input",value:"text"},{label:"Number Input",value:"number"},{label:"Range Slider",value:"range"},{label:"URL Link",value:"url"},{label:"Text Area",value:"textarea"},{label:"Rich Text Content",value:"contentEditor"},{label:"Image/Media",value:"image"},{label:"File Upload",value:"file"},{label:"Gallery",value:"gallery"},{label:"Date Picker",value:"date"},{label:"Date Time Picker",value:"datetime"},{label:"Time Picker",value:"time"},{label:"Color Picker",value:"color"},{label:"Icon Picker",value:"icon"},{label:"Repeater/Group",value:"repeater"},{label:"Relational (Post Select)",value:"relational"}],u=e=>e.toLowerCase().replace(/[^a-z0-9_]/g,""),c=({initialConfig:t,blockSlug:c})=>{const[p,b]=l(t.fields||[]),[y,g]=l(!1),[m,f]=l(null),[h,v]=l(""),[k,x]=l(t.template||""),C=(e,l,t)=>{const a=p.map((a,i)=>i===e?("key"===l&&(t=t.toLowerCase().replace(/[^a-z0-9_]/g,"")),{...a,[l]:t}):a);b(a),f(a[e])},S=(e,l,t,o)=>{const c=e.subFields||[],p=(e,a,i)=>{const n=c.map((l,t)=>t===e?("key"===a&&(i=u(i)),{...l,[a]:i}):l);t(l,"subFields",n)};return a(r,{title:"Repeater Sub-Fields",initialOpen:!0},a("h4",null,"Add New Sub-Field"),a("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",marginBottom:"15px"}},d.filter(e=>"repeater"!==e.value&&"relational"!==e.value).map(e=>a(i,{isSecondary:!0,onClick:()=>(e=>{const a={type:e,key:u(`sub_field_${c.length}_${e}`),label:`New ${e} Sub-Field`,default:""};t(l,"subFields",[...c,a])})(e.value)},e.label))),a("h4",null,`Current Sub-Fields (${c.length})`),c.length>0?c.map((e,o)=>((e,o)=>a(r,{title:`${e.label} (${e.type})`,initialOpen:!1,key:o,className:"repeater-sub-field-settings"},a(n,{label:"Sub-Field Label",value:e.label,onChange:e=>p(o,"label",e)}),a(n,{label:"Attribute Key (Variable Name)",value:e.key,help:"Must be unique, lowercase, and contain only letters, numbers, and underscores.",onChange:e=>p(o,"key",e)}),a(s,{label:"Sub-Field Type",value:e.type,options:d.map(e=>({label:e.label,value:e.value})).filter(e=>"repeater"!==e.value),onChange:e=>p(o,"type",e)}),a(i,{isDestructive:!0,onClick:()=>(e=>{const a=c.filter((l,t)=>t!==e);t(l,"subFields",a)})(o),style:{marginTop:"10px"}},"Delete Sub-Field")))(e,o)):a("p",null,"No sub-fields defined. Add one above."))};return a("div",{style:{display:"flex",gap:"20px",marginTop:"20px"}},a("div",{style:{width:"20%",borderRight:"1px solid #ccc",paddingRight:"20px"}},a("h3",null,"Component Palette"),d.map(e=>a(i,{isSecondary:!0,style:{display:"block",width:"100%",marginBottom:"10px"},onClick:()=>(e=>{const l={type:e,key:`new_field_${p.length}`,label:`New ${e} Field`,default:""};b([...p,l]),f(l)})(e.value)},e.label))),a("div",{style:{width:"40%"}},a("h3",null,"Block Structure"),p.map((e,l)=>a("div",{key:l,style:{padding:"10px",marginBottom:"8px",border:"1px solid #ddd",backgroundColor:m===e?"#eaf4ff":"#fff",cursor:"pointer",display:"flex",justifyContent:"space-between"},onClick:()=>f(e)},a("span",null,`${e.label} (${e.type})`),a(i,{isSmall:!0,isTertiary:!0,onClick:l=>{l.stopPropagation(),(e=>{const l=document.getElementById("bf-html-template-area"),t=l.selectionStart,a=l.selectionEnd,i=l.value,n=`{{${e}}}`,o=i.substring(0,t)+n+i.substring(a);x(o),setTimeout(()=>{l.focus(),l.setSelectionRange(t+n.length,t+n.length)},10)})(e.key)}},"Add to HTML"))),a("hr",{style:{margin:"20px 0"}}),a("h3",null,"2. HTML Template"),a("p",{style:{fontSize:"12px",color:"#666"}},'Write your HTML below. Click the "Add to HTML" buttons above or use {{field_key}} placeholders.'),a("textarea",{id:"bf-html-template-area",value:k,onChange:e=>x(e.target.value),style:{width:"100%",minHeight:"350px",fontFamily:"monospace",padding:"12px",fontSize:"13px",border:"1px solid #757575",borderRadius:"4px"},placeholder:`<div class="banner">\n  <h2>{{${p[0]?.key||"field_key"}}}</h2>\n</div>`}),a("hr",null),a(i,{isPrimary:!0,isBusy:y,onClick:()=>(()=>{g(!0),v("");const e={action:"block_factory_save_structure",nonce:blockFactoryEditorData.nonce,block_slug:c,config_data:JSON.stringify({fields:p,template:k})};jQuery.post(ajaxurl,e).done(e=>{e.success?v(`✅ Success! ${e.data.message} ${e.data.next_step}`):v(`❌ Error: ${e.data.message}`)}).fail(()=>{v("❌ Critical Error: Could not reach the server.")}).always(()=>{g(!1)})})(),disabled:y},y?"Compiling Code...":"Save Structure & Build Block"),h&&a("p",{style:{marginTop:"15px",fontWeight:"bold"}},h)),a("div",{style:{width:"40%"}},(()=>{if(!m)return(0,e.jsx)("p",{children:"Select a field on the left to edit its properties."});const l=p.indexOf(m);return(0,e.jsxs)(o,{header:"Field Settings",children:[(0,e.jsxs)(r,{title:`Editing: ${m.label} (${m.type})`,initialOpen:!0,children:[(0,e.jsx)(n,{label:"Field Label",value:m.label,onChange:e=>C(l,"label",e)}),(0,e.jsx)(n,{label:"Attribute Key (Variable Name)",value:m.key,help:"Must be unique, lowercase, and contain only letters, numbers, and underscores.",onChange:e=>C(l,"key",e)}),(0,e.jsx)(n,{label:"Default Value (Optional)",value:m.default,onChange:e=>C(l,"default",e)}),(0,e.jsx)(i,{isDestructive:!0,onClick:()=>(e=>{b(p.filter((l,t)=>t!==e)),f(null)})(l),style:{marginTop:"10px"},children:"Delete Field"})]}),"repeater"===m.type&&S(m,l,C)]})})()))};jQuery(document).ready(function(){const e=document.getElementById("component-editor-root");e&&"undefined"!=typeof blockFactoryEditorData&&wp.element.render(a(c,{initialConfig:blockFactoryEditorData.config,blockSlug:blockFactoryEditorData.blockSlug}),e)})})();