(()=>{const{useState:e,useEffect:l,createElement:t}=wp.element,{Button:a,TextControl:o,Panel:n,PanelBody:i,SelectControl:r}=wp.components,u=[{label:"Text Input",value:"text"},{label:"Number Input",value:"number"},{label:"Range Slider",value:"range"},{label:"URL Link",value:"url"},{label:"Text Area",value:"textarea"},{label:"Rich Text Content",value:"contentEditor"},{label:"Image/Media",value:"image"},{label:"File Upload",value:"file"},{label:"Gallery",value:"gallery"},{label:"Date Picker",value:"date"},{label:"Date Time Picker",value:"datetime"},{label:"Time Picker",value:"time"},{label:"Color Picker",value:"color"},{label:"Icon Picker",value:"icon"},{label:"Repeater/Group",value:"repeater"},{label:"Relational (Post Select)",value:"relational"}],c=({initialConfig:l,blockSlug:r})=>{const[c,d]=e(l.fields||[]),[s,p]=e(!1),[b,g]=e(null),[y,f]=e(""),m=(e,l,t)=>{const a=c.map((a,o)=>o===e?("key"===l&&(t=t.toLowerCase().replace(/[^a-z0-9_]/g,"")),{...a,[l]:t}):a);d(a),g(a[e])};return t("div",{style:{display:"flex",gap:"20px",marginTop:"20px"}},t("div",{style:{width:"20%",borderRight:"1px solid #ccc",paddingRight:"20px"}},t("h3",null,"Component Palette"),u.map(e=>t(a,{isSecondary:!0,style:{display:"block",width:"100%",marginBottom:"10px"},onClick:()=>(e=>{const l={type:e,key:`new_field_${c.length}`,label:`New ${e} Field`,default:""};d([...c,l]),g(l)})(e.value)},e.label))),t("div",{style:{width:"40%"}},t("h3",null,"Block Structure"),c.map((e,l)=>t("div",{key:l,style:{padding:"10px",marginBottom:"8px",border:"1px solid #ddd",backgroundColor:b===e?"#eaf4ff":"#fff",cursor:"pointer"},onClick:()=>g(e)},`${e.label} (${e.type})`)),t("hr",null),t(a,{isPrimary:!0,isBusy:s,onClick:()=>{p(!0),f("");const e={action:"block_factory_save_structure",nonce:blockFactoryEditorData.nonce,block_slug:r,config_data:JSON.stringify({fields:c})};jQuery.post(ajaxurl,e).done(e=>{e.success?f(`✅ Success! ${e.data.message} ${e.data.next_step}`):f(`❌ Error: ${e.data.message}`)}).fail(()=>{f("❌ Critical Error: Could not reach the server.")}).always(()=>{p(!1)})},disabled:s},s?"Saving...":"Save Structure & Regenerate Code"),y&&t("p",{style:{marginTop:"15px",fontWeight:"bold"}},y)),t("div",{style:{width:"40%"}},(()=>{if(!b)return t("p",null,"Select a field on the left to edit its properties.");const e=c.indexOf(b);return t(n,{header:"Field Settings"},t(i,{title:`Editing: ${b.label} (${b.type})`,initialOpen:!0},t(o,{label:"Field Label",value:b.label,onChange:l=>m(e,"label",l)}),t(o,{label:"Attribute Key (Variable Name)",value:b.key,help:"Must be unique, lowercase, and contain only letters, numbers, and underscores.",onChange:l=>m(e,"key",l)}),t(o,{label:"Default Value (Optional)",value:b.default,onChange:l=>m(e,"default",l)}),t(a,{isDestructive:!0,onClick:()=>(e=>{d(c.filter((l,t)=>t!==e)),g(null)})(e),style:{marginTop:"10px"}},"Delete Field")))})()))};jQuery(document).ready(function(){const e=document.getElementById("component-editor-root");e&&"undefined"!=typeof blockFactoryEditorData&&wp.element.render(t(c,{initialConfig:blockFactoryEditorData.config,blockSlug:blockFactoryEditorData.blockSlug}),e)})})();